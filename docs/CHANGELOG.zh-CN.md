# 更新日志

Youwee 的所有重要更改都将记录在此文件中。

格式基于 [Keep a Changelog](https://keepachangelog.com/en/1.1.0/)，
本项目遵循 [语义化版本](https://semver.org/spec/v2.0.0.html)。

## [Unreleased]

### 新增
- **字幕工坊** - 新增一体化字幕页面，支持 SRT/VTT/ASS，包含文本编辑、时间轴工具、查找替换、自动修复和 AI 功能（Whisper、翻译、语法修正）
- **高级字幕工具** - 新增波形/频谱时间轴、镜头切换同步、基于风格预设的实时质检、拆分合并、双栏翻译模式（原文/译文）以及项目批处理工具

### 变更

### 修复

## [0.9.4] - 2026-02-14

### 新增
- **Processing 输出目录选择器** - 在 Processing 聊天区新增输出目录选择按钮。默认仍为主视频所在目录，AI 命令与快速操作都会使用所选目录输出
- **Processing AI 聊天多类型附件** - Processing 聊天现支持图片/视频/字幕附件（文件选择 + 拖拽），并按类型显示预览与元数据
- **设置中的语言投票快捷入口** - 在 设置 → 通用 中新增快捷链接，用户可前往 GitHub Discussions 投票/请求下一种支持语言
- **系统托盘新增应用更新检查** - 在托盘菜单新增动作，可直接检查 Youwee 应用更新

### 变更
- **更稳定的字幕/合并命令生成** - Processing 命令生成在回退到 AI 前，优先走确定性逻辑处理字幕烧录与多视频合并（含 intro/outro 顺序提示）
- **托盘频道检查文案更清晰** - 将 “立即全部检查” 调整为更明确的已关注频道检查文案，避免歧义
- **页面标题更简洁** - 移除 Metadata、Processing、AI Summary 页面标题前的图标，界面更清爽

### 修复
- **启用认证/代理时获取视频信息失败** - 修复 yt-dlp 参数顺序，将 cookie 和代理参数插入到 URL 分隔符 `--` 之前，避免出现 `Failed to fetch video info`，同时保持下载流程正常
- **Stable 频道更新检查始终显示可更新** - 修复 stable/nightly 的 yt-dlp 更新检查逻辑，改为读取已安装频道二进制的真实版本（`--version`），而不是仅依据文件存在元数据，从而在更新后正确显示“已是最新”
- **Bundled 更新状态与实际使用二进制不一致** - 修复 bundled 更新流程：在设置页正确显示最新可用版本，并在存在时优先使用已更新的 `app_data/bin/yt-dlp`，使 bundled 更新真正生效
- **优化 Processing 页面视频信息区** - 将播放器下方信息重做为 YouTube 风格（标题 + 现代化元数据标签），并移除编解码标签的 hover 变色与阴影，视觉更简洁
- **Prompt Templates 下拉框不会自动关闭** - 修复 Processing 的 Prompt Templates 下拉框，现在点击外部区域或按 Escape 键会自动关闭
- **Universal URL 计数重复显示** - 修复 Universal 输入框 URL 计数徽标重复数字的问题（例如 `1 1 URL`）

## [0.9.3] - 2026-02-14

### 新增
- **元数据中下载字幕** - 在元数据设置栏新增字幕开关，可在获取元数据时同时下载字幕（手动 + 自动生成）。包含弹出窗口用于选择语言和格式（SRT/VTT/ASS）

### 变更
- **改进时间范围输入体验** - 将普通文本输入替换为自动格式化时间输入，输入时自动插入 `:` 分隔符（如 `1030` → `10:30`，`10530` → `1:05:30`）。智能占位符根据视频时长显示 `M:SS` 或 `H:MM:SS`。实时验证，格式无效或开始时间 >= 结束时间时显示红色边框。可用时显示视频总时长提示

## [0.9.2] - 2026-02-13

### 新增
- **按时间范围下载** - 通过设置开始和结束时间仅下载视频的特定部分（如 10:30 到 14:30）。可在 YouTube 和 Universal 队列中通过剪刀图标为每个视频单独设置。底层使用 yt-dlp 的 `--download-sections`
- **启动时自动检查 FFmpeg 更新** - FFmpeg 更新检查现在在应用启动时自动运行（仅限内置安装）。如有可用更新，将在设置 > 依赖项中显示，无需手动点击刷新按钮

## [0.9.1] - 2026-02-13

### 修复
- **未安装 Homebrew 的 macOS 上应用崩溃** - 修复因缺少 `liblzma` 动态库导致的启动崩溃。`xz2` crate 现使用静态链接，使应用完全独立，无需 Homebrew 或系统库
- **自动下载忽略用户设置** - 频道自动下载现在使用每个频道的独立下载设置（视频/音频模式、画质、格式、编解码器、比特率），不再使用硬编码默认值。每个频道在频道设置面板中可单独配置下载偏好
- **安全加固** - FFmpeg 命令现使用结构化参数数组代替 shell 字符串解析，防止命令注入。为所有 yt-dlp 调用添加 URL scheme 验证和 `--` 分隔符以阻止选项注入。启用内容安全策略，移除过宽的 shell 权限，并为渲染链接添加 `isSafeUrl` 验证
- **MKV/AVI/FLV/TS 容器视频预览失败** - 预览检测现在同时检查容器格式和编解码器。不受支持的容器（MKV、AVI、FLV、WMV、TS、WebM、OGG）中的视频会自动转码为 H.264 预览。macOS 上 MP4/MOV 中的 HEVC 不再被不必要地转码
- **定时下载在托盘模式下不可见** - 当应用最小化到系统托盘时，定时下载开始、停止或完成时会发送桌面通知。托盘菜单显示活动定时状态（如"YouTube: 23:00"）。定时功能在 YouTube 和 Universal 页面均可使用
- **从托盘退出会中断活动下载** - 托盘"退出"现在使用优雅关闭而非强制终止进程，允许活动下载完成清理，防止文件损坏
- **Dock 图标设置重启后丢失 (macOS)** - "关闭时隐藏 Dock 图标"偏好设置现在在应用启动时同步到原生层，而非仅在访问设置页面时同步
- **通用队列加载时显示骨架屏而非 URL** - 将闪烁的骨架屏占位符替换为实际 URL 文本和"正在加载信息..."旋转徽章。当元数据获取失败时，项目现在会正常退出加载状态，而非永远显示骨架屏

## [0.9.0] - 2026-02-12

### 新增
- **频道关注与自动下载** - 关注 YouTube 频道，浏览视频，批量选择下载，支持完整的画质/编解码器/格式设置。后台轮询检测新上传并发送桌面通知，每频道显示新视频数量徽章。可折叠的关注频道面板，支持系统托盘最小化
- **大文件预览确认** - 可配置的文件大小阈值（默认 300MB），在处理页面加载大型视频前显示确认对话框。可在设置 → 通用 → 处理中调整阈值
- **多语言设置搜索** - 设置搜索现在支持所有语言。用中文搜索（如"主题"）或越南文搜索均可返回匹配结果。英文关键词始终作为后备方案

### 修复
- **Linux 上处理页面加载 4K VP9/AV1/HEVC 视频时白屏** - GStreamer 的 AAC 音频解码器在播放 VP9/AV1/HEVC 视频时导致 WebKitGTK 崩溃。预览现使用双元素方案：静音 H.264 视频 + 独立 WAV 音频通过 JavaScript 同步播放，完全绕过有问题的 AAC 路径。若视频播放仍失败，自动回退到静态 JPEG 缩略图。支持 macOS、Windows 和 Linux

## [0.8.2] - 2026-02-11

### 新增
- **多语言更新说明** - 更新对话框现在按用户语言显示发布说明（英文、越南文、中文）。CI 自动从对应语言的 CHANGELOG 文件中提取更新日志
- **通用下载支持 8K/4K/2K 画质** - 画质下拉菜单新增 8K 超高清、4K 超高清和 2K QHD 选项，与 YouTube 标签页一致。如果来源没有高分辨率格式，会自动降级到最高可用画质
- **通用下载"从头录制直播"开关** - 高级设置中新增开关，可从直播开头录制而非当前时间点。使用 yt-dlp 的 `--live-from-start` 参数
- **通用下载视频预览** - 添加 TikTok、Bilibili、Facebook、Instagram、Twitter 等网站的 URL 时自动显示缩略图、标题、时长和频道。缩略图也会保存到媒体库历史记录
- **更智能的平台识别** - 媒体库现在能正确识别和标记 yt-dlp 支持的 1800 多个网站（Bilibili、Dailymotion、SoundCloud 等），不再显示"其他"。新增 Bilibili 专用筛选标签

### 修复
- **Linux 上处理页面上传视频时冻结** - 视频文件通过 `readFile()` 被完整读入内存，导致内存溢出和白屏。现在使用 Tauri 的 asset 协议直接流式传输视频，无需加载到内存。同时添加错误边界防止白屏、带编解码器信息的视频错误处理、blob URL 清理防止内存泄漏、以及非 MP4 格式的正确 MIME 类型检测
- **媒体库中缩略图损坏** - 修复 Bilibili 等使用 HTTP URL 的网站缩略图。缩略图加载失败时现在会优雅地显示占位图标
- **切换页面时媒体库不刷新** - 媒体库现在在导航到页面时自动加载最新下载记录，无需手动刷新
